<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{admin/layouts/ad_layout}">

<th:block layout:fragment="content">
	<div class="container mt-5">
		<div class="row">
			<div class="col">
				<div class="card card-primary">
					<div class="card-header">
						<h3 class="card-title">상품리뷰목록</h3>
					</div>
					<!-- /.card-header -->
					<!-- list start -->
					<div class="card-body">
						<!-- search form start -->
						<form id="searchForm" action="/admin/review/review_list" method="get">
							<div class="row">
								<div class="col-2">검색어</div>
								<div class="col-3">
									<select name="searchType" class="form-control">
										<option value="" th:selected= "${''} == ${pageMaker.cri.searchType}">전체</option>
										<option value="n" th:selected= "${'n'} == ${pageMaker.cri.searchType}">상품명</option>
										<option value="c" th:selected= "${'c'} == ${pageMaker.cri.searchType}">상품코드</option>
										<option value="i" th:selected= "${'i'} == ${pageMaker.cri.searchType}">작성자ID</option>
									</select>
								</div>
								<div class="col-7">
									<input type="text" name="keyword" class="form-control" th:value="${pageMaker.cri.keyword}" placeholder="검색어를 입력하세요">
								</div>
							</div>

							<div class="row mt-3">
								<div class="col-2">평점/내용</div>
								<div class="col-3">
                                    <select class="form-control" name="rev_rate">
                                        <option value="">전체평점</option>
                                        <option value="5" th:selected= "${rev_rate == '5'}">5</option>
                                        <option value="4" th:selected= "${rev_rate == '4'}">4</option>
                                        <option value="3" th:selected= "${rev_rate == '3'}">3</option>
                                        <option value="2" th:selected= "${rev_rate == '2'}">2</option>
                                        <option value="1" th:selected= "${rev_rate == '1'}">1</option>
                                    </select>
								</div>
								<div class="col-7">
									<input type="text" name="rev_content" class="form-control" th:value="${rev_content}">
								</div>
							</div>

							<div class="row mt-3">
								<div class="col text-center">
									<button type="submit" class="btn btn-primary">검색</button>
									<button type="button" class="btn btn-outline-primary">초기화</button>
								</div>
							</div>
						</form>
						<div class="row mt-2">
							<div class="col">
								<form name="frm_pro_list" id="frm_pro_list" method="post" action="/admin/product/pro_sel_delete_2">
									<table class="table table-bordered">
										<thead>
											<tr>												
												<th style="width: 10%;">번호</th>
												<th style="width: 10%;">답변</th>
												<th style="width: 20%;">상품정보</th>
												<th style="width: 30%">평점 / 내용</th>
												<th style="width: 10%">작성자</th>
												<th style="width: 10%">작성일</th>
												<th style="width: 10%">관리</th>
											</tr>
										</thead>
										<tbody>
											<tr th:each="reviewVO : ${review_list}">
												<td>[[${reviewVO.rev_code}]]</td>
												<td>
													<div class="alert alert-success" role="alert" th:if="${#lists.size(reviewVO.replies) > 0}">답변완료</div>
													<div class="alert alert-danger" role="alert" th:unless="${#lists.size(reviewVO.replies) > 0}">답변대기</div>
												</td>
												<td>
													<img style="width: 100px; height: 100px;" th:src="${'/admin/review/image_display?dateFolderName=' + reviewVO.product.pro_upfolder + '&fileName=s_' + reviewVO.product.pro_img}">
													[[${reviewVO.product.pro_num}]]<br>
													[[${reviewVO.product.pro_name}]]
												</td>
												<td>
													<span class="star" style="color: red; font-size: large;">[[${reviewVO.rev_rate}]]</span><br>
													[[${reviewVO.rev_content}]]
													<div th:each= "reply : ${reviewVO.replies}">
														<div class="row">
															<div class="col">관리자</div>
															<div class="col"><span th:text="${#temporals.format(reply.reply_date, 'yyyy-MM-dd HH:mm:ss')}"></span></div>
														</div>
												
													<div class="row">
														<div class="col"><span th:text="${reply.reply_text}"></span></div>
													</div>
													<div>
														<button type="button" class="btn btn-outline-success" name="btn_reply_edit" th:data-reply_id="${reply.reply_id}">답변수정</button>
														<button type="button" class="btn btn-outline-danger" name="btn_reply_del" th:data-reply_id="${reply.reply_id}">답변삭제</button>
													</div>
													</div>
												</td>

												<td>[[${reviewVO.mc_email}]]</td>
												<td>[[${#temporals.format(reviewVO.rev_date, 'yyyy-MM-dd HH:mm:ss')}]]</td>
												<td>
													<button type="button" class="btn btn-block btn-sm btn-outline-primary" th:data-rev_code="${reviewVO.rev_code}">수정</button>
													<button type="button" class="btn btn-block btn-sm btn-outline-primary" th:data-rev_code="${reviewVO.rev_code}">삭제</button>
												</td>
											</tr>
										</tbody>
									</table>
								</form>
								<!-- 페이징및검색 파라미터 정보 : 현재 목록상태를 작업(수정,삭제)을 하고 돌아왔을 때 유지. -->
								<form id="criteriaForm" action="/admain/review/review_list" method="get">
									<input type="hidden" name="page" id="page" th:value="${pageMaker.cri.page}" /> 
									<input type="hidden" name="perPageNum" id="perPageNum" th:value="${pageMaker.cri.perPageNum}" /> 
									<input type="hidden" name="searchType" id="searchType" th:value="${pageMaker.cri.searchType}" />
									<input type="hidden" name="keyword" id="keyword" th:value="${pageMaker.cri.keyword}" />
									
									<input type="hidden" name="rev_rate" id="rev_rate" th:value="${rev_rate}">
									<input type="hidden" name="rev_content" id="rev_content" th:value="${rev_content}">
								</form>
							</div>
						</div>
					</div>
					<div class="card-footer clearfix">
						<nav aria-label="Page navigation example">
							<ul class="pagination">
								<!-- 이전표시여부 Previous  pageMaker.getPrev() -->
								<th:block th:if="${pageMaker.prev}">
									<li class="page-item"><a class="page-link" th:href="|/admin/product/pro_list${pageMaker.makeSearch(pageMaker.startPage - 1)}|">&laquo;</a></li>
								</th:block>
								<!--  페이지번호 출력.  1  2  3  4  5 -->
								<th:block th:each="num : ${#numbers.sequence(pageMaker.startPage, pageMaker.endPage)}">
									<li class="page-item" th:classappend="${pageMaker.cri.page == num ? 'active' : ''}"><a class="page-link" th:href="|/admin/product/pro_list${pageMaker.makeSearch(num)}|" th:text="${num}"></a></li>
								</th:block>

								<!--  다음표시여부 Next -->
								<th:block th:if="${pageMaker.next}">
									<li class="page-item"><a class="page-link" th:href="|/admin/product/pro_list${pageMaker.makeSearch(pageMaker.endPage + 1)}|">&raquo;</a></li>
								</th:block>
							</ul>
						</nav>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!--Modal 써보기-->
	<div class="modal" tabindex="-1">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Modal title</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
					<div class="modal-body">
					<p>Modal body text goes here.</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
					<button type="button" class="btn btn-primary">Save changes</button>
				</div>
			</div>
		</div>
	</div>
</th:block>
</html>